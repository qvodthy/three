<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
        html, body { height: 100%; margin: 0; padding: 0; }
        #map { height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="https://unpkg.com/@reactivex/rxjs@5.0.0-beta.12/dist/global/Rx.js"></script>
<script type="text/javascript">

    var God = {
        address: '上海市浦东新区孙环路177弄42栋501',
    };

    var suobi = {
        address: '复旦大学(邯郸校区)',
    };

    var dongbi = {
        address: '东华大学松江校区',
    };

    var players = [God, suobi, dongbi];

    var map;
    function initMap() {
        var service = new google.maps.DistanceMatrixService();
//        var sbj = new Rx.Subject();

        /*players.forEach(function (player) {
            geocoder.geocode({'address': player.address}, function(results, status) {
                if (status === google.maps.GeocoderStatus.OK) {
                    player.location = results[0].geometry.location;
                    sbj.next(player);
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        });
        sbj.subscribe(p => console.log(p));*/
        operator(Rx.Observable.from(players))
            .subscribe(player => console.log(_.has(player, 'location')));

        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -34.397, lng: 150.644},
            zoom: 8
        });

//        geocodeAddress(geocoder);

    }


    function geocodeAddress(geocoder) {
        var address = ["复旦大学(邯郸校区)", "东华大学松江校区"];
        address.forEach(function (a) {
            geocoder.geocode({'address': a}, function(results, status) {
                if (status === google.maps.GeocoderStatus.OK) {
                    console.log(results[0].geometry.location.toString());
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        });
    }

    function operator(input) {
        var geocoder = new google.maps.Geocoder();

        var output = Rx.Observable.create(function subscribe(observer) {
            input.subscribe({
                next: (v) => observer.next(10 * v),
                /*next: function (v) {
                    console.log('next');
                    geocoder.geocode({'address': v.address}, function(results, status) {
                        console.log('geocoder');
                        if (status === google.maps.GeocoderStatus.OK) {
                            v.location = results[0].geometry.location;
                            observer.next('map');
                        } else {
                            alert('Geocode was not successful for the following reason: ' + status);
                        }
                    });
                },*/
                next: v => 10,
                error: (err) => observer.error(err),
                complete: () => observer.complete()
            });
        });
        return output;
    }

</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQ2lQAfU7YfSyqpFDNeeqRwwylsZwDnUM&callback=initMap">
</script>
</body>
</html>